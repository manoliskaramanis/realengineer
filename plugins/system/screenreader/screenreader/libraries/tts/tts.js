(function(a){a.frTTSEngine=function(d){var i;var x;var b;var m;var h;var k;var u;var f;var c;var s=new Array();var r=null;var v=0;function e(A){h=0;k=w(h+u);firstChunk=m.substring(h,k);if(firstChunk.length){soundManager.createSound({id:"chunkSound",url:c.baseURI+"plugins/system/screenreader/screenreader/libraries/tts/"+c.readerEngine+".php?lang="+f+"&engine_token="+c.engineToken+"&token="+c.token+"&text="+encodeURIComponent(firstChunk),autoLoad:false,type:"audio/mp3"});soundManager.play("chunkSound",{onfinish:function(){soundManager.destroySound("chunkSound");if(s.length){if(c.preload){l(s)}else{o(s)}}else{g("finished");return}}});r="chunkSound"}else{g("notext");return}if(m.substr(k)&&c.preload){var z=0;var y=function(){h=k;k=w(h+u);A=m.substring(h,k);var B=soundManager.createSound({id:"chunkSound"+z,url:c.baseURI+"plugins/system/screenreader/screenreader/libraries/tts/"+c.readerEngine+".php?lang="+f+"&engine_token="+c.engineToken+"&token="+c.token+"&text="+encodeURIComponent(A),autoLoad:false,type:"audio/mp3"});B.load();s.push(B);z++;if(m.substr(k)){b=setTimeout(function(){if(x!=="stop"){y()}},3000)}};b=setTimeout(function(){if(x!=="stop"){y()}},3000)}else{if(m.substr(k)){var z=0;while(m.substr(k)){h=k;k=w(h+u);A=m.substring(h,k);s.push(A);z++}}}}function l(z){var y=z.splice(0,1);if(a.isArray(y)&&y.length){soundManager.play(y[0]["id"],{onfinish:function(){soundManager.destroySound(y[0]["id"]);l(z)}});r=y[0]["id"]}else{g("finished");return}}function o(B){var z=B.splice(0,1);var y="chunkSound"+v;if(a.isArray(z)&&z.length){var A=soundManager.createSound({id:y,url:c.baseURI+"plugins/system/screenreader/screenreader/libraries/tts/"+c.readerEngine+".php?lang="+f+"&engine_token="+c.engineToken+"&token="+c.token+"&text="+encodeURIComponent(z[0]),autoLoad:false,type:"audio/mp3"});soundManager.play(y,{onfinish:function(){soundManager.destroySound(y);o(B)}});r=y;v++}else{g("finished");return}}function j(){soundManager.stopAll();soundManager.destroySound("chunkSound");a.each(soundManager.sounds,function(y,z){soundManager.destroySound(z.id)});s=new Array();r=null}function w(A){if(m.charAt(A)==" "){return A}var z=m.substr(A);if(z.indexOf(" ")==-1){var y=z.length+A;return y}else{var B=z.indexOf(" ")+A;return B}}function q(){var y=a("#volume_plugin");var C=c.screenReaderVolume/20;var A=5;for(var z=0;z<A;z++){var B=!!(z<C)?" active":"";a(y).append('<div id="volume_step'+(z+1)+'" class="volume_step'+B+'" data-value="'+parseInt((z+1)*20)+'" accesskey="'+(z+1)+'"></div>')}}function p(){var A="";if(window.getSelection){A=window.getSelection().toString()}else{if(document.selection&&document.selection.type!="Control"){A=document.selection.createRange().text}}if(!!c.readPage&&!A){if(!!c.readChildNodes){if(c.excludeScripts){var B=a(c.mainpageSelector).clone().find("script").remove().end().filter(function(){if(this.nodeName&&this.nodeName.toLowerCase()=="script"){return false}return true});A=a.trim(a(B).text())}else{A=a.trim(a(c.mainpageSelector).text())}if(c.readImages){var y="";var z=a(B).find("img");a.each(z,function(D,E){var C=a(E).attr(c.readImagesAttribute);if(C){y+=C}});if(c.readImagesOrdering=="before"){A=y+A}else{A=A;+y}}}else{A=a.trim(a(c.mainpageSelector).immediateText())}}A=A.replace(/[\n\r\t]/g," ");A=A.replace(/\s+/g," ");return A}function g(y){switch(y){case"playing":a("div#tts_message").remove();a("<div/>").attr("id","tts_message").css("background-color",c.toolbarBgcolor).prependTo("#accessibility-links").append('<div id="playicon"></div>');a("#playicon").css("background-color",c.toolbarBgcolor);break;case"paused":a("div#tts_message").remove();a("<div/>").attr("id","tts_message").css("background-color",c.toolbarBgcolor).prependTo("#accessibility-links").append('<div id="msgtext">'+fr_paused+"</div>");break;case"finished":r=null;a("div#tts_message").fadeOut(500,function(){a(this).remove()});break;case"notext":a("div#tts_message").remove();a("<div/>").attr("id","tts_message").css("background-color",c.toolbarBgcolor).prependTo("#accessibility-links").append('<div id="msgtext">'+fr_notext+"</div>").delay(1500).fadeOut(500,function(){a(this).remove()});break}}function n(){a(document).on("click.frTTS","#fr_screenreader_play",function(y){i=true;x="play";clearTimeout(b);m=p();if(!m.length){g("notext")}else{j();e();g("playing")}a("#fr_screenreader_pause").removeClass("active");y.stopPropagation();y.preventDefault()});a(document).on("click.frTTS","#fr_screenreader_pause",function(y){if(!r){return}switch(i){case true:i=false;x="pause";soundManager.pause(r);g("paused");a(this).addClass("active");break;case false:i=true;x="play";soundManager.resume(r);g("playing");a(this).removeClass("active");break}});a(document).on("click.frTTS","#fr_screenreader_stop",function(y){i=false;x="stop";clearTimeout(b);a("#fr_screenreader_pause").removeClass("active");j();g("finished")});a(document).on("click.frTTS","div.volume_step",function(y){a(this).siblings("div").removeClass("active");a(this).prevAll("div").addClass("active");a(this).addClass("active");soundManager.setVolume(r,parseInt(a(this).attr("data-value")))})}(function t(){a.fn.extend({immediateText:function(){return this.clone().find("*").remove().end().text()}});var A=this;i=false;x="stop";var z={baseURI:null,toolbarBgcolor:"#EEE",token:null,langCode:"en",chunkLength:80,screenReaderVolume:80,preload:0,readPage:1,readChildNodes:1,excludeScripts:1,readImages:0,readImagesAttribute:"alt",readImagesOrdering:"before",mainpageSelector:"*[name*=main], *[class*=main], *[id*=main], *[id*=container], *[class*=container]",readerEngine:"proxy",engineToken:0};c=a.extend({},z,d);if(c.readerEngine=="proxy_fallback"){a.getJSON("http://api.naturalreaders.com/v2/auth/requesttoken?callback=?",{appid:"de52ydkplza",appsecret:"g13pqbr77k84cggw4oscsggwcos8sco"},null).always(function(D,C,E){if(C=="success"&&D.rst=="true"){c.engineToken=D.requesttoken}})}var B=new Image();B.src=c.baseURI+"plugins/system/screenreader/screenreader/libraries/controller/css/images/waves.gif";f=c.langCode;u=c.chunkLength;var y=function(){var E=!!("ontouchstart" in window);var C=!!(navigator.msMaxTouchPoints);var D=E||C;return D};if(y()){c.preload=0}q();if(c.template=="custom.css"){a("#volume_plugin").css("background",c.toolbarBgcolor)}n()}).call(this);this.getState=function(){return i}}})(jQuery);